{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\Sistemas\\\\Desktop\\\\produnthuntnext\\\\pages\\\\nuevo-producto.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useContext } from 'react';\nimport FileUploader from \"react-firebase-file-uploader\";\nimport Layout from \"../components/layout/Layout\";\nimport Router, { useRouter } from \"next/router\";\nimport { Formulario, Campo, InputSubmit, Titulo, Error } from \"../components/ui/Formulario\";\nimport Error404 from \"../components/layout/404\"; //Importando el firebase para iniciar la conexion \n\nimport { FirebaseContext } from \"../firebase\"; //Utilizando el hooks validacion\n\nimport useValidacion from \"../hooks/useValidacion\";\nimport validarCrearProducto from \"../validacion/validarCrearProducto\";\nvar STATE_INICIAL = {\n  nombre: \"\",\n  empresa: \"\",\n  imagen: \"\",\n  url: \"\",\n  descripcion: \"\"\n};\n\nvar NuevoProducto = function NuevoProducto() {\n  _s();\n\n  //State de las imagenes \n  var _useState = useState(\"\"),\n      nombreimagen = _useState[0],\n      guardarNombre = _useState[1];\n\n  var _useState2 = useState(false),\n      subiendo = _useState2[0],\n      guardarSubiendo = _useState2[1];\n\n  var _useState3 = useState(0),\n      progreso = _useState3[0],\n      guardarProgreso = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      urlimagen = _useState4[0],\n      guardarUrlImagen = _useState4[1];\n\n  var _useValidacion = useValidacion(STATE_INICIAL, validarCrearProducto, crearProducto),\n      valores = _useValidacion.valores,\n      errores = _useValidacion.errores,\n      submitForm = _useValidacion.submitForm,\n      handleSubmit = _useValidacion.handleSubmit,\n      handleChange = _useValidacion.handleChange,\n      handleBlur = _useValidacion.handleBlur;\n\n  var nombre = valores.nombre,\n      empresa = valores.empresa,\n      imagen = valores.imagen,\n      url = valores.url,\n      descripcion = valores.descripcion; //HOOK  de routing para rideccionar \n\n  var router = useRouter(); //Context con las operaciones crud de firebase \n\n  var _useContext = useContext(FirebaseContext),\n      usuario = _useContext.usuario,\n      firebase = _useContext.firebase;\n\n  function crearProducto() {\n    return _crearProducto.apply(this, arguments);\n  } //Funciones para cargar la imagen y mostrar informacion llenando los state\n\n\n  function _crearProducto() {\n    _crearProducto = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var producto;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (usuario) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", router.push(\"/login\"));\n\n            case 2:\n              //Crear el objeto de nuevo producto\n              producto = {\n                nombre: nombre,\n                empresa: empresa,\n                url: url,\n                urlimagen: urlimagen,\n                descripcion: descripcion,\n                votos: 0,\n                comentarios: [],\n                creado: Date.now(),\n                creador: {\n                  id: usuario.uid,\n                  nombre: usuario.displayName\n                },\n                haVotado: []\n              }; //Insertarlo en la base de datos\n\n              firebase.db.collection(\"productos\").add(producto);\n              return _context.abrupt(\"return\", router.push(\"/\"));\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _crearProducto.apply(this, arguments);\n  }\n\n  var handleUploadStart = function handleUploadStart() {\n    guardarProgreso(0);\n    guardarSubiendo(true);\n  };\n\n  var handleProgress = function handleProgress(progreso) {\n    return guardarProgreso({\n      progreso: progreso\n    });\n  };\n\n  var handleUploadError = function handleUploadError(error) {\n    guardarSubiendo(error);\n    console.log(error);\n  };\n\n  var handleUploadSuccess = function handleUploadSuccess(nombre) {\n    guardarProgreso(100);\n    guardarSubiendo(false);\n    guardarNombre(nombre);\n    firebase.storage.ref(\"productos\").child(nombre).getDownloadURL().then(function (url) {\n      console.log(url);\n      guardarUrlImagen(url);\n    });\n  };\n\n  return __jsx(Layout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }\n  }, usuario ? __jsx(React.Fragment, null, __jsx(Titulo, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 17\n    }\n  }, \"Nuevo Producto\"), __jsx(Formulario, {\n    onSubmit: handleSubmit,\n    noValidate: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 17\n    }\n  }, __jsx(\"fieldset\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 21\n    }\n  }, __jsx(\"legend\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 25\n    }\n  }, \"Informacion General\"), __jsx(Campo, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 29\n    }\n  }, __jsx(\"label\", {\n    htmlFor: \"nombre\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 33\n    }\n  }, \"Nombre\"), __jsx(\"input\", {\n    type: \"text\",\n    id: \"nombre\",\n    placeholder: \"Tu Nombre\",\n    name: \"nombre\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: nombre,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 33\n    }\n  })), errores.nombre && __jsx(Error, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 48\n    }\n  }, errores.nombre), __jsx(Campo, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 29\n    }\n  }, __jsx(\"label\", {\n    htmlFor: \"empresa\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 33\n    }\n  }, \"Empresa: \"), __jsx(\"input\", {\n    type: \"text\",\n    id: \"empresa\",\n    placeholder: \"Empresa\",\n    name: \"empresa\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: empresa,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 33\n    }\n  })), errores.empresa && __jsx(Error, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 49\n    }\n  }, errores.empresa), __jsx(Campo, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 29\n    }\n  }, __jsx(\"label\", {\n    htmlFor: \"imagen\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 33\n    }\n  }, \"Imagen\"), __jsx(FileUploader, {\n    accept: \"image/*\",\n    id: \"imagen\",\n    name: \"imagen\",\n    randomizeFilename: true,\n    storageRef: firebase.storage.ref(\"productos\"),\n    onUploadStart: handleUploadStart,\n    onUploadError: handleUploadError,\n    onUploadSuccess: handleUploadSuccess,\n    onProgress: handleProgress,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 33\n    }\n  })), __jsx(Campo, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 29\n    }\n  }, __jsx(\"label\", {\n    htmlFor: \"url\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 33\n    }\n  }, \"URL\"), __jsx(\"input\", {\n    type: \"url\",\n    id: \"url\",\n    name: \"url\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: url,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 33\n    }\n  })), errores.url && __jsx(Error, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 45\n    }\n  }, errores.url)), __jsx(\"fieldset\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 21\n    }\n  }, __jsx(\"legend\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 25\n    }\n  }, \"Sobre tu producto\"), __jsx(Campo, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 25\n    }\n  }, __jsx(\"label\", {\n    htmlFor: \"descripcion\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 33\n    }\n  }, \"Descripcion\"), __jsx(\"textarea\", {\n    id: \"descripcion\",\n    name: \"descripcion\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: descripcion,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 33\n    }\n  })), errores.descripcion && __jsx(Error, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 49\n    }\n  }, errores.descripcion)), __jsx(InputSubmit, {\n    type: \"submit\",\n    value: \"Crear Producto\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 21\n    }\n  }))) : __jsx(Error404, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 15\n    }\n  }));\n};\n\n_s(NuevoProducto, \"LwrVcBZTZ+No9+MKdCiiAUBE1MM=\", false, function () {\n  return [useValidacion, useRouter];\n});\n\n_c = NuevoProducto;\nexport default NuevoProducto;\n\nvar _c;\n\n$RefreshReg$(_c, \"NuevoProducto\");","map":{"version":3,"sources":["C:/Users/Sistemas/Desktop/produnthuntnext/pages/nuevo-producto.js"],"names":["React","useState","useContext","FileUploader","Layout","Router","useRouter","Formulario","Campo","InputSubmit","Titulo","Error","Error404","FirebaseContext","useValidacion","validarCrearProducto","STATE_INICIAL","nombre","empresa","imagen","url","descripcion","NuevoProducto","nombreimagen","guardarNombre","subiendo","guardarSubiendo","progreso","guardarProgreso","urlimagen","guardarUrlImagen","crearProducto","valores","errores","submitForm","handleSubmit","handleChange","handleBlur","router","usuario","firebase","push","producto","votos","comentarios","creado","Date","now","creador","id","uid","displayName","haVotado","db","collection","add","handleUploadStart","handleProgress","handleUploadError","error","console","log","handleUploadSuccess","storage","ref","child","getDownloadURL","then"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\r\nimport FileUploader from \"react-firebase-file-uploader\"\r\nimport Layout from \"../components/layout/Layout\";\r\nimport Router, { useRouter } from \"next/router\";\r\nimport { Formulario, Campo, InputSubmit, Titulo, Error} from \"../components/ui/Formulario\";\r\nimport Error404 from \"../components/layout/404\";\r\n//Importando el firebase para iniciar la conexion \r\nimport { FirebaseContext } from \"../firebase\";\r\n\r\n//Utilizando el hooks validacion\r\nimport useValidacion from \"../hooks/useValidacion\";\r\nimport validarCrearProducto from \"../validacion/validarCrearProducto\";\r\n\r\nconst STATE_INICIAL = {\r\n    nombre: \"\",\r\n    empresa: \"\",\r\n    imagen: \"\",\r\n    url: \"\",\r\n    descripcion: \"\"\r\n}\r\n\r\nconst NuevoProducto = () => {\r\n\r\n    //State de las imagenes \r\n    const [nombreimagen, guardarNombre] = useState(\"\");\r\n    const [subiendo, guardarSubiendo] = useState(false);\r\n    const [progreso, guardarProgreso] = useState(0);\r\n    const [urlimagen, guardarUrlImagen] = useState(\"\");\r\n\r\n    const { valores, errores, submitForm, handleSubmit, handleChange, handleBlur } = useValidacion(STATE_INICIAL, validarCrearProducto, crearProducto);\r\n\r\n    const {nombre, empresa, imagen, url, descripcion} = valores;\r\n\r\n    //HOOK  de routing para rideccionar \r\n    const router = useRouter();\r\n\r\n    //Context con las operaciones crud de firebase \r\n    const { usuario, firebase } = useContext(FirebaseContext);\r\n    \r\n    async function crearProducto(){\r\n        //Si el usuario no esta autenticado llevar al login\r\n        if(!usuario){\r\n            return router.push(\"/login\");\r\n        }\r\n\r\n        //Crear el objeto de nuevo producto\r\n        const producto = {\r\n            nombre,\r\n            empresa,\r\n            url,\r\n            urlimagen,\r\n            descripcion,\r\n            votos: 0,\r\n            comentarios: [],\r\n            creado: Date.now(),\r\n            creador: {\r\n                id: usuario.uid,\r\n                nombre: usuario.displayName\r\n            },\r\n            haVotado: []\r\n        }\r\n        //Insertarlo en la base de datos\r\n        firebase.db.collection(\"productos\").add(producto);\r\n\r\n        return router.push(\"/\");\r\n    }\r\n\r\n    //Funciones para cargar la imagen y mostrar informacion llenando los state\r\n    const handleUploadStart = () => {\r\n        guardarProgreso(0);\r\n        guardarSubiendo(true);\r\n    }\r\n    const handleProgress = progreso => guardarProgreso( { progreso });\r\n\r\n    const handleUploadError = error => {\r\n        guardarSubiendo(error);\r\n        console.log(error);\r\n    }\r\n\r\n    const handleUploadSuccess = nombre => {\r\n        guardarProgreso(100);\r\n        guardarSubiendo(false);\r\n        guardarNombre(nombre);\r\n        firebase\r\n            .storage\r\n            .ref(\"productos\")\r\n            .child(nombre)\r\n            .getDownloadURL()\r\n            .then(url => {\r\n                console.log(url);\r\n                guardarUrlImagen(url);\r\n            \r\n            } )\r\n    }\r\n\r\n    return ( \r\n        <Layout>\r\n            {usuario ? <>\r\n                <Titulo>Nuevo Producto</Titulo>\r\n                <Formulario\r\n                    onSubmit = {handleSubmit}\r\n                    noValidate\r\n                >\r\n                    <fieldset>\r\n                        <legend>Informacion General</legend>\r\n                            <Campo>\r\n                                <label htmlFor=\"nombre\">Nombre</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    id=\"nombre\"\r\n                                    placeholder=\"Tu Nombre\"\r\n                                    name=\"nombre\"\r\n                                    onChange={handleChange}\r\n                                    onBlur = {handleBlur}\r\n                                    value={nombre}\r\n                                />\r\n                            </Campo>\r\n                            {errores.nombre && <Error>{errores.nombre}</Error>}\r\n                            <Campo>\r\n                                <label htmlFor=\"empresa\">Empresa: </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    id=\"empresa\"\r\n                                    placeholder=\"Empresa\"\r\n                                    name=\"empresa\"\r\n                                    onChange={handleChange}\r\n                                    onBlur = {handleBlur}\r\n                                    value={empresa}\r\n                                />\r\n                            </Campo>\r\n                            {errores.empresa && <Error>{errores.empresa}</Error>}\r\n                            <Campo>\r\n                                <label htmlFor=\"imagen\">Imagen</label>\r\n                                <FileUploader\r\n                                    accept=\"image/*\"\r\n                                    id=\"imagen\"\r\n                                    name=\"imagen\"\r\n                                    randomizeFilename\r\n                                    storageRef={firebase.storage.ref(\"productos\")}\r\n                                    onUploadStart={handleUploadStart}\r\n                                    onUploadError={handleUploadError}\r\n                                    onUploadSuccess={handleUploadSuccess}\r\n                                    onProgress={handleProgress}\r\n                                />\r\n                            </Campo>\r\n                        \r\n                            <Campo>\r\n                                <label htmlFor=\"url\">URL</label>\r\n                                <input\r\n                                    type=\"url\"\r\n                                    id=\"url\"\r\n                                    name=\"url\"\r\n                                    onChange={handleChange}\r\n                                    onBlur = {handleBlur}\r\n                                    value={url}\r\n                                />\r\n                            </Campo>\r\n                            {errores.url && <Error>{errores.url}</Error>}\r\n                    </fieldset>\r\n                    \r\n                    <fieldset>\r\n                        <legend>Sobre tu producto</legend>\r\n                        <Campo>\r\n                                <label htmlFor=\"descripcion\">Descripcion</label>\r\n                                <textarea\r\n                                    id=\"descripcion\"\r\n                                    name=\"descripcion\"\r\n                                    onChange={handleChange}\r\n                                    onBlur = {handleBlur}\r\n                                    value={descripcion}\r\n                                />\r\n                        </Campo>\r\n                        {errores.descripcion && <Error>{errores.descripcion}</Error>}\r\n                    </fieldset>\r\n                    <InputSubmit\r\n                        type=\"submit\"\r\n                        value=\"Crear Producto\"\r\n                    />\r\n                </Formulario>\r\n                </>\r\n            : <Error404/>}\r\n        </Layout>\r\n     );\r\n}\r\nexport default NuevoProducto;"]},"metadata":{},"sourceType":"module"}